{% extends 'sales/base.html' %}

{% block content %}
    <label for="user_dropdown" id="user_dropdown_label">USER:</label>
    <select name="user_dropdown" id = "user_dropdown">
        <option selected></option>
        {% for user in user_data.all_users %}
            <option value="{{ user }}">{{ user }}</option>
        {% endfor %} 
    </select>
    <button id="user_submit" onclick="user_submit()">Submit</button>

    {% if not user_data.username %}
        <h1> Please choose a User!</h1>
    {% else %}
            <div>
                <h1>{{ user_data.username }}</h1>
        {% if user_data.cases.assigned_cases != 0  %}
                <h3>CASES</h3>
                <p>Assigned Cases: {{ user_data.cases.assigned_cases }}</p>
                <p>Closed Cases: {{ user_data.cases.closed_cases }}</p>
                <p>Open Cases: {{ user_data.cases.open_cases }}</p>
                <p><i class="fa fa-smile"></i>: {{ user_data.cases.feedback.satisfied }}</p>
                <p><i class="fa fa-meh"></i>: {{ user_data.cases.feedback.neutral }}</p>
                <p><i class="fa fa-frown"></i>: {{ user_data.cases.feedback.not_satisfied }}</p>
                <p>Avg Time Spent: {{ user_data.cases.avg_time_spent }}</p>
            </div>
        {% endif %}

        {% if user_data.calls %}
                <h3>CALLS</h3>
                <p>All Calls: {{ user_data.calls.all_calls }}</p>
            </div>
        {% endif %}

        {% if user_data.issues.assigned != 0 %}
                <h3>Redmine ISSUES</h3>
                <p>Assigned Issues: {{ user_data.issues.assigned }} </p>
                <p>Open Issues: {{ user_data.issues.open_issues | length}} </p>
                <p>Resolved Issues: {{ user_data.issues.closed_issues | length}} </p>
                <p>Rejected Issues: {{ user_data.issues.rejected_issues | length}} </p>
            </div>
            <input type=checkbox id="show_label_all">
            <label for="show_label_all" class="show_label">OPEN ISSUES</label>
            <div id = "case_table_all">
                <table class = "scrollable_table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Number</th>
                            <th>Project</th>
                            <th>Author</th>
                            <th>Assigned To</th>
                            <th>Subject</th>
                            <th>Status</th>
                            <th>Created (UTC)</th>
                            <th>Modified (UTC)</th>
                            <th>Resolved (UTC)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for issue in user_data.issues.open_issues %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td><a href='{{url}}/issues/{{ issue.issue_id }}'>{{ issue.issue_id }}</a></td>
                                <td>{{ issue.project_name }}</td>
                                <td>{{ issue.author_name }}</td>
                                <td>{{ issue.assigned_to_name }}</td>
                                <td>{{ issue.subject }}</td>
                                <td>{{ issue.status_name }}</td>
                                <td>{{ issue.created_on }}</td>
                                <td>{{ issue.updated_on }}</td>
                                <td>{{ issue.closed_on }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    {% endif %}

{% endblock %}